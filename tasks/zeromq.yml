---

- name: Unarchive libzmq.
  unarchive:
    remote_src: false
    src: "{{ libzmq_package }}"
    dest: /usr/local/src/
    creates: "/usr/local/src/{{ libzmq_package | regex_replace('\\.zip', '')| regex_replace('\\.tar.gz', '') }}"

- name: Compile libzmq.
  shell: ./autogen.sh;./configure;make -j{{ ansible_processor_cores|default(1) + 1 }}
  args:
    chdir: /usr/local/src/libzmq
    creates: /usr/local/src/libtool

- name: Install libzmq.
  shell: make install
  args:
    chdir: /usr/local/src/libzmq
    creates: /usr/local/lib/libzmq.a

- name: Unarchive zeromq.
  unarchive:
    remote_src: false
    src: "{{ zeromq_package }}"
    dest: /usr/local/src/
    creates: "/usr/local/src/{{ zeromq_package | regex_replace('\\.zip', '')| regex_replace('\\.tar.gz', '') }}"

- name: Compile zeromq.
  shell: ./autogen.sh;./configure;make -j{{ ansible_processor_cores|default(1) + 1 }}
  args:
    chdir: /usr/local/src/zeromq-4.0.3
    creates: /usr/local/src/libtool

- name: Install zeromq.
  shell: make install
  args:
    chdir: /usr/local/src/zeromq-4.0.3

- name: Unarchive pyzmq.
  unarchive:
    remote_src: false
    src: "{{ pyzmq_package }}"
    dest: /usr/local/src/
    creates: "/usr/local/src/{{ pyzmq_package | regex_replace('\\.zip', '')| regex_replace('\\.tar.gz', '') }}"

- name: Install pyzmq.
  shell: python setup.py install
  args:
    chdir: /usr/local/src/pyzmq-14.1.1
    creates: /usr/lib64/python2.7/site-packages/zmq/__init__.py

- name: Unarchive czmq.
  unarchive:
    remote_src: false
    src: "{{ czmq_package }}"
    dest: /usr/local/src/
    creates: "/usr/local/src/{{ czmq_package | regex_replace('\\.zip', '')| regex_replace('\\.tar.gz', '') }}"

- name: Compile czmq.
  shell: ./configure;make -j{{ ansible_processor_cores|default(1) + 1 }};
  args:
    chdir: /usr/local/src/czmq-4.1.1
    creates: /usr/local/src/libtool

- name: Install czmq.
  shell: make install
  args:
    chdir: /usr/local/src/czmq-4.1.1
    creates: /usr/local/lib/libczmq.a

- name: Add zmq library.
  blockinfile:
    path: /etc/ld.so.conf
    block: "/usr/local/lib/"

- name: reload ldconfig.
  shell: ldconfig
